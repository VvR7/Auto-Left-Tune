# 左右手音量控制功能

## 功能概述

这个功能允许用户在MIDI播放时独立调整左手和右手的音量比例，默认情况下左手音量为右手音量的80%。

## 功能实现

### 1. 配置管理 (`app/config/config.py`)
- 添加了 `LEFT_HAND_VOLUME_RATIO = 0.8` 配置项
- 左手音量默认设置为右手的80%

### 2. JavaScript配置管理 (`app/static/js/config.js`)
- `MidiPlayerConfig` 类管理左右手音量配置
- 支持localStorage持久化存储配置
- 提供配置变化事件通知机制

### 3. MIDI播放器更新
- **主播放器** (`app/static/js/midiPlayer.js`): 
  - 在 `playNote` 方法中根据音符的手部属性调整音量
  - 左手音符的音量会乘以配置的比例值
  - 支持动态配置更新

- **演奏示例播放器** (`app/static/js/performance.js`):
  - 同样的左右手音量调整逻辑
  - 与主播放器保持一致的配置管理

### 4. 用户界面
- **控制面板**: 在主页面和演奏页面添加了左右手音量控制按钮 (🤲)
- **滑块控制**: 用户可以通过滑块调整左手音量比例 (0% - 100%)
- **重置功能**: 一键重置为默认的80%
- **实时反馈**: 调整时显示当前百分比

### 5. 样式设计 (`app/static/css/style.css`)
- 新增了 `.hand-volume-control-wrapper` 和相关样式
- 使用橙色渐变主题区分于主音量控制
- 响应式面板设计，支持点击外部关闭

## 使用方法

### 用户操作流程
1. 加载或播放MIDI文件
2. 点击播放器控制区域的左右手音量按钮 (🤲)
3. 使用滑块调整左手音量比例
4. 实时听到左手音量的变化
5. 点击"重置默认"按钮可恢复到80%

### 开发者配置
可以通过修改以下位置来调整默认值：

1. **Python配置**:
```python
# app/config/config.py
LEFT_HAND_VOLUME_RATIO = 0.8  # 修改默认比例
```

2. **JavaScript配置**:
```javascript
// app/static/js/config.js
this.defaultConfig = {
    leftHandVolumeRatio: 0.8, // 修改默认比例
    // ...
};
```

## 技术细节

### 音符识别机制
- 使用 `determineTrackHand()` 方法识别轨道的左右手属性
- 支持轨道名称关键词识别（如"left", "bass", "右手"等）
- 基于音符平均音高的智能判断（低于中央C认为是左手）
- 基于轨道索引的默认分配规则

### 音量调整算法
```javascript
if (hand === 'left') {
    velocity = velocity * this.leftHandVolumeRatio;
}
```

### 配置持久化
- 用户的设置会自动保存到浏览器的localStorage
- 页面刷新后设置会自动恢复
- 支持多页面间的配置同步

## 扩展性

这个实现提供了良好的扩展性：

1. **添加右手音量控制**: 可以轻松添加右手音量的独立控制
2. **更多音轨支持**: 可以扩展支持更多乐器音轨的音量控制
3. **预设方案**: 可以添加不同的音量预设方案
4. **音效处理**: 可以为左右手添加不同的音效处理

## 兼容性

- 兼容所有现有的MIDI文件格式
- 不影响原有的主音量控制功能
- 与倍速播放、进度控制等功能完全兼容
- 支持所有主流浏览器 